"use strict";var e=require("react");function r(e,r,t,n){return new(t||(t=Promise))((function(o,c){function s(e){try{i(n.next(e))}catch(e){c(e)}}function a(e){try{i(n.throw(e))}catch(e){c(e)}}function i(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(s,a)}i((n=n.apply(e,r||[])).next())}))}function t(e,r){var t,n,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(c=0)),c;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,n=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=r.call(e,c)}catch(e){a=[6,e],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}"function"==typeof SuppressedError&&SuppressedError;var n="https://api.spotify.com";exports.useSpotify=function(o){var c=o.client_id,s=o.client_secret,a=o.refresh_token,i=e.useRef(null),u=e.useMemo((function(){return Buffer.from("".concat(c,":").concat(s)).toString("base64")}),[c,s]),l=e.useRef(null),f=e.useCallback((function(){return r(void 0,void 0,void 0,(function(){var e,r,n,o,c,s;return t(this,(function(t){switch(t.label){case 0:if(i.current)return[2,i.current];if(!a||""===a.trim())throw new Error("Invalid refresh_token: Expected a non-empty string, but received ".concat(JSON.stringify(a)));e=new URLSearchParams({grant_type:"refresh_token",refresh_token:a}),t.label=1;case 1:return t.trys.push([1,6,,7]),[4,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic ".concat(u),"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:e})];case 2:return(r=t.sent()).ok?[3,4]:[4,r.text()];case 3:throw n=t.sent(),new Error("Failed to fetch access token: ".concat(r.status," ").concat(r.statusText,". ").concat(n));case 4:return[4,r.json()];case 5:if(!(o=t.sent()).access_token)throw new Error("Access token not found in the response");return i.current=o.access_token,[2,o.access_token];case 6:throw c=t.sent(),s="Failed to fetch access token",c instanceof Error?s+=": ".concat(c.message):s+="string"==typeof c?": ".concat(c):": An unknown error occurred",console.error(s,c),new Error(s);case 7:return[2]}}))}))}),[a,u]),h=e.useCallback((function(){return r(void 0,void 0,void 0,(function(){var e,r,o,c;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,f()];case 1:if(!(e=t.sent()))throw new Error("Access token is missing or invalid");return[4,fetch("".concat(n,"/v1/me"),{headers:{Authorization:"Bearer ".concat(e)}})];case 2:if(!(r=t.sent()).ok)throw new Error("Failed to fetch user info: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 3:return[2,t.sent()];case 4:throw o=t.sent(),c="Failed to retrieve user info",o instanceof Error?c+=": ".concat(o.message):c+="string"==typeof o?": ".concat(o):": An unknown error occurred",console.error("Error fetching user info:",o),new Error(c);case 5:return[2]}}))}))}),[f]),d=e.useCallback((function(e,o,c){return r(void 0,void 0,void 0,(function(){var r,s,a,i;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,f()];case 1:if(!(r=t.sent()))throw new Error("Access token is missing or invalid");if(!e||""===e.trim())throw new Error("Invalid user ID: Expected a non-empty string, but received ".concat(JSON.stringify(e)));if(o&&(o<0||o>50))throw new Error("Invalid limit value: Expected to be between 0 and 50, but recieved ".concat(o));if(c&&(c<0||c>100))throw new Error("Invalid offset value: Expected to be between 0 and 100, but recieved ".concat(c));return[4,fetch("\n                ".concat(n,"/v1/users/").concat(e,"/playlists?limit=").concat(o||20,"&offset=").concat(c||5,"\n            "),{headers:{Authorization:"Bearer ".concat(r)}})];case 2:if(!(s=t.sent()).ok)throw new Error("Failed to fetch playlists: ".concat(s.status," ").concat(s.statusText));return[4,s.json()];case 3:return[2,t.sent().items];case 4:throw a=t.sent(),i="Failed to retrieve playlists for user ".concat(e||"${userId}"),a instanceof Error?i+=": ".concat(a.message):i+="string"==typeof a?": ".concat(a):": An unknown error occurred",console.error("Error fetching playlists for user ".concat(e,":"),a),new Error(i);case 5:return[2]}}))}))}),[f]),w=e.useCallback((function(e){return r(void 0,void 0,void 0,(function(){var r,o,c,s;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,f()];case 1:if(!(r=t.sent()))throw new Error("Access token is missing or invalid");if(!e||""===e)throw new Error("Invalid playlist ID: Expected a non-empty string, but received ".concat(JSON.stringify(e)));return[4,fetch("".concat(n,"/v1/playlists/").concat(e,"/tracks"),{headers:{Authorization:"Bearer ".concat(r)}})];case 2:if(!(o=t.sent()).ok)throw new Error("Failed to fetch playlist tracks: ".concat(o.status," ").concat(o.statusText));return[4,o.json()];case 3:return[2,t.sent().items];case 4:throw c=t.sent(),s="Failed to retrieve tracks for playlist ".concat(e||"${id}"),c instanceof Error?s+=": ".concat(c.message):s+="string"==typeof c?": ".concat(c):": An unknown error occurred",console.error("Error fetching tracks for playlist ".concat(e,":"),c),new Error(s);case 5:return[2]}}))}))}),[f]),p=e.useCallback((function(){return r(void 0,void 0,void 0,(function(){var e,r,o,c;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,f()];case 1:if(!(e=t.sent()))throw new Error("Access token is missing or invalid");return[4,fetch("".concat(n,"/v1/me/player/currently-playing"),{headers:{Authorization:"Bearer ".concat(e)}})];case 2:if(204===(r=t.sent()).status)return[2,null];if(!r.ok)throw new Error("Failed to fetch currently playing song: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 3:return[2,t.sent().item];case 4:throw o=t.sent(),c="Failed to retrieve currently playing song",o instanceof Error?c+=": ".concat(o.message):c+="string"==typeof o?": ".concat(o):": An unknown error occurred",console.error("Error fetching currently playing song:",o),new Error(c);case 5:return[2]}}))}))}),[f]),v=e.useCallback((function(e,o){return r(void 0,void 0,void 0,(function(){var c;return t(this,(function(s){switch(s.label){case 0:return[4,f()];case 1:if(!(c=s.sent()))throw new Error("Access token is missing or invalid");if(!e)throw new Error("Invalid query string: Expected a non-empty string, but received ".concat(JSON.stringify(e)));return[2,new Promise((function(s,a){l.current&&clearTimeout(l.current),l.current=setTimeout((function(){return r(void 0,void 0,void 0,(function(){var r,o,i,u;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,fetch("".concat(n,"/v1/search?q=").concat(encodeURIComponent(e),"&type=track&limit=10"),{headers:{Authorization:"Bearer ".concat(c)}})];case 1:if(!(r=t.sent()).ok)throw new Error("Failed to search songs: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 2:return o=t.sent(),s(o.tracks.items),[3,4];case 3:return i=t.sent(),u="Failed to search songs",i instanceof Error?u+=": ".concat(i.message):u+="string"==typeof i?": ".concat(i):": An unknown error occurred",console.error("Error searching songs:",i),a(new Error(u)),[3,4];case 4:return[2]}}))}))}),o||600)}))]}}))}))}),[f]);return{getUserInfo:h,getPlaylists:d,getPlaylistSongs:w,getCurrentlyPlayingSong:p,searchSongs:v}};
//# sourceMappingURL=index.js.map
