import{useRef as r,useMemo as e,useCallback as t}from"react";function n(r,e,t,n){return new(t||(t=Promise))((function(o,c){function s(r){try{i(n.next(r))}catch(r){c(r)}}function a(r){try{i(n.throw(r))}catch(r){c(r)}}function i(r){var e;r.done?o(r.value):(e=r.value,e instanceof t?e:new t((function(r){r(e)}))).then(s,a)}i((n=n.apply(r,e||[])).next())}))}function o(r,e){var t,n,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(c=0)),c;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,n=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(r,c)}catch(r){a=[6,r],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}"function"==typeof SuppressedError&&SuppressedError;var c="https://api.spotify.com",s=function(s){var a=s.client_id,i=s.client_secret,u=s.refresh_token,l=r(null),f=e((function(){return Buffer.from("".concat(a,":").concat(i)).toString("base64")}),[a,i]),h=r(null),d=t((function(){return n(void 0,void 0,void 0,(function(){var r,e,t,n,c,s;return o(this,(function(o){switch(o.label){case 0:if(l.current)return[2,l.current];if(!u||""===u.trim())throw new Error("Invalid refresh_token: Expected a non-empty string, but received ".concat(JSON.stringify(u)));r=new URLSearchParams({grant_type:"refresh_token",refresh_token:u}),o.label=1;case 1:return o.trys.push([1,6,,7]),[4,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic ".concat(f),"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:r})];case 2:return(e=o.sent()).ok?[3,4]:[4,e.text()];case 3:throw t=o.sent(),new Error("Failed to fetch access token: ".concat(e.status," ").concat(e.statusText,". ").concat(t));case 4:return[4,e.json()];case 5:if(!(n=o.sent()).access_token)throw new Error("Access token not found in the response");return l.current=n.access_token,[2,n.access_token];case 6:throw c=o.sent(),s="Failed to fetch access token",c instanceof Error?s+=": ".concat(c.message):s+="string"==typeof c?": ".concat(c):": An unknown error occurred",console.error(s,c),new Error(s);case 7:return[2]}}))}))}),[u,f]),w=t((function(){return n(void 0,void 0,void 0,(function(){var r,e,t,n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,d()];case 1:if(!(r=o.sent()))throw new Error("Access token is missing or invalid");return[4,fetch("".concat(c,"/v1/me"),{headers:{Authorization:"Bearer ".concat(r)}})];case 2:if(!(e=o.sent()).ok)throw new Error("Failed to fetch user info: ".concat(e.status," ").concat(e.statusText));return[4,e.json()];case 3:return[2,o.sent()];case 4:throw t=o.sent(),n="Failed to retrieve user info",t instanceof Error?n+=": ".concat(t.message):n+="string"==typeof t?": ".concat(t):": An unknown error occurred",console.error("Error fetching user info:",t),new Error(n);case 5:return[2]}}))}))}),[d]),p=t((function(r,e,t){return n(void 0,void 0,void 0,(function(){var n,s,a,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,d()];case 1:if(!(n=o.sent()))throw new Error("Access token is missing or invalid");if(!r||""===r.trim())throw new Error("Invalid user ID: Expected a non-empty string, but received ".concat(JSON.stringify(r)));if(e&&(e<0||e>50))throw new Error("Invalid limit value: Expected to be between 0 and 50, but recieved ".concat(e));if(t&&(t<0||t>100))throw new Error("Invalid offset value: Expected to be between 0 and 100, but recieved ".concat(t));return[4,fetch("\n                ".concat(c,"/v1/users/").concat(r,"/playlists?limit=").concat(e||20,"&offset=").concat(t||5,"\n            "),{headers:{Authorization:"Bearer ".concat(n)}})];case 2:if(!(s=o.sent()).ok)throw new Error("Failed to fetch playlists: ".concat(s.status," ").concat(s.statusText));return[4,s.json()];case 3:return[2,o.sent().items];case 4:throw a=o.sent(),i="Failed to retrieve playlists for user ".concat(r||"${userId}"),a instanceof Error?i+=": ".concat(a.message):i+="string"==typeof a?": ".concat(a):": An unknown error occurred",console.error("Error fetching playlists for user ".concat(r,":"),a),new Error(i);case 5:return[2]}}))}))}),[d]),v=t((function(r){return n(void 0,void 0,void 0,(function(){var e,t,n,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,d()];case 1:if(!(e=o.sent()))throw new Error("Access token is missing or invalid");if(!r||""===r)throw new Error("Invalid playlist ID: Expected a non-empty string, but received ".concat(JSON.stringify(r)));return[4,fetch("".concat(c,"/v1/playlists/").concat(r,"/tracks"),{headers:{Authorization:"Bearer ".concat(e)}})];case 2:if(!(t=o.sent()).ok)throw new Error("Failed to fetch playlist tracks: ".concat(t.status," ").concat(t.statusText));return[4,t.json()];case 3:return[2,o.sent().items];case 4:throw n=o.sent(),s="Failed to retrieve tracks for playlist ".concat(r||"${id}"),n instanceof Error?s+=": ".concat(n.message):s+="string"==typeof n?": ".concat(n):": An unknown error occurred",console.error("Error fetching tracks for playlist ".concat(r,":"),n),new Error(s);case 5:return[2]}}))}))}),[d]),y=t((function(){return n(void 0,void 0,void 0,(function(){var r,e,t,n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,d()];case 1:if(!(r=o.sent()))throw new Error("Access token is missing or invalid");return[4,fetch("".concat(c,"/v1/me/player/currently-playing"),{headers:{Authorization:"Bearer ".concat(r)}})];case 2:if(204===(e=o.sent()).status)return[2,null];if(!e.ok)throw new Error("Failed to fetch currently playing song: ".concat(e.status," ").concat(e.statusText));return[4,e.json()];case 3:return[2,o.sent().item];case 4:throw t=o.sent(),n="Failed to retrieve currently playing song",t instanceof Error?n+=": ".concat(t.message):n+="string"==typeof t?": ".concat(t):": An unknown error occurred",console.error("Error fetching currently playing song:",t),new Error(n);case 5:return[2]}}))}))}),[d]),g=t((function(r,e){return n(void 0,void 0,void 0,(function(){var t;return o(this,(function(s){switch(s.label){case 0:return[4,d()];case 1:if(!(t=s.sent()))throw new Error("Access token is missing or invalid");if(!r)throw new Error("Invalid query string: Expected a non-empty string, but received ".concat(JSON.stringify(r)));return[2,new Promise((function(s,a){h.current&&clearTimeout(h.current),h.current=setTimeout((function(){return n(void 0,void 0,void 0,(function(){var e,n,i,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("".concat(c,"/v1/search?q=").concat(encodeURIComponent(r),"&type=track&limit=10"),{headers:{Authorization:"Bearer ".concat(t)}})];case 1:if(!(e=o.sent()).ok)throw new Error("Failed to search songs: ".concat(e.status," ").concat(e.statusText));return[4,e.json()];case 2:return n=o.sent(),s(n.tracks.items),[3,4];case 3:return i=o.sent(),u="Failed to search songs",i instanceof Error?u+=": ".concat(i.message):u+="string"==typeof i?": ".concat(i):": An unknown error occurred",console.error("Error searching songs:",i),a(new Error(u)),[3,4];case 4:return[2]}}))}))}),e||600)}))]}}))}))}),[d]);return{getUserInfo:w,getPlaylists:p,getPlaylistSongs:v,getCurrentlyPlayingSong:y,searchSongs:g}};export{s as useSpotify};
//# sourceMappingURL=index.mjs.map
