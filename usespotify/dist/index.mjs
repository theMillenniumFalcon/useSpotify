import{useCallback as t}from"react";function r(t,r,e,n){return new(e||(e=Promise))((function(o,c){function s(t){try{i(n.next(t))}catch(t){c(t)}}function a(t){try{i(n.throw(t))}catch(t){c(t)}}function i(t){var r;t.done?o(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(s,a)}i((n=n.apply(t,r||[])).next())}))}function e(t,r){var e,n,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(i){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(c=0)),c;)try{if(e=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,n=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=r.call(t,c)}catch(t){a=[6,t],n=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}"function"==typeof SuppressedError&&SuppressedError;var n="https://api.spotify.com",o=function(o){var c=o.client_id,s=o.client_secret,a=o.refresh_token,i=o.user_id,u=o.playlist_id,l=Buffer.from("".concat(null!=c?c:"",":").concat(null!=s?s:"")).toString("base64"),f=function(){return r(void 0,void 0,void 0,(function(){var t,r,n,o,c,s;return e(this,(function(e){switch(e.label){case 0:if(!a||""===a.trim())throw new Error("Invalid refresh_token: Expected a non-empty string, but received ".concat(JSON.stringify(a)));t=new URLSearchParams({grant_type:"refresh_token",refresh_token:a}),e.label=1;case 1:return e.trys.push([1,6,,7]),[4,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic ".concat(l),"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:t})];case 2:return(r=e.sent()).ok?[3,4]:[4,r.text()];case 3:throw n=e.sent(),new Error("Failed to fetch access token: ".concat(r.status," ").concat(r.statusText,". ").concat(n));case 4:return[4,r.json()];case 5:if(!(o=e.sent()).access_token)throw new Error("Access token not found in the response");return[2,o.access_token];case 6:throw c=e.sent(),s="Failed to fetch access token",c instanceof Error?s+=": ".concat(c.message):s+="string"==typeof c?": ".concat(c):": An unknown error occurred",console.error(s,c),new Error(s);case 7:return[2]}}))}))},h=t((function(){return r(void 0,void 0,void 0,(function(){var t,r,o,c;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,f()];case 1:if(!(t=e.sent()))throw new Error("Access token is missing or invalid");if(!i||""===i.trim())throw new Error("Invalid user ID: Expected a non-empty string, but received ".concat(JSON.stringify(i)));return[4,fetch("".concat(n,"/v1/users/").concat(i,"/playlists"),{headers:{Authorization:"Bearer ".concat(t)}})];case 2:if(!(r=e.sent()).ok)throw new Error("Failed to fetch playlists: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 3:return[2,e.sent().items];case 4:throw o=e.sent(),c="Failed to retrieve playlists for user ".concat(i||"${userId}"),o instanceof Error?c+=": ".concat(o.message):c+="string"==typeof o?": ".concat(o):": An unknown error occurred",console.error("Error fetching playlists for user ".concat(i,":"),o),new Error(c);case 5:return[2]}}))}))}),[i,l]),p=t((function(){return r(void 0,void 0,void 0,(function(){var t,r,o,c;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,f()];case 1:if(!(t=e.sent()))throw new Error("Access token is missing or invalid");if(!u||""===u)throw new Error("Invalid playlist ID: Expected a non-empty string, but received ".concat(JSON.stringify(u)));return[4,fetch("".concat(n,"/v1/playlists/").concat(u,"/tracks"),{headers:{Authorization:"Bearer ".concat(t)}})];case 2:if(!(r=e.sent()).ok)throw new Error("Failed to fetch playlist tracks: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 3:return[2,e.sent().items];case 4:throw o=e.sent(),c="Failed to retrieve tracks for playlist ".concat(u||"${id}"),o instanceof Error?c+=": ".concat(o.message):c+="string"==typeof o?": ".concat(o):": An unknown error occurred",console.error("Error fetching tracks for playlist ".concat(u,":"),o),new Error(c);case 5:return[2]}}))}))}),[l]),d=t((function(){return r(void 0,void 0,void 0,(function(){var t,r,o,c;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,f()];case 1:if(!(t=e.sent()))throw new Error("Access token is missing or invalid");return[4,fetch("".concat(n,"/v1/me/player/currently-playing"),{headers:{Authorization:"Bearer ".concat(t)}})];case 2:if(204===(r=e.sent()).status)return[2,null];if(!r.ok)throw new Error("Failed to fetch currently playing song: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 3:return[2,e.sent().item];case 4:throw o=e.sent(),c="Failed to retrieve currently playing song",o instanceof Error?c+=": ".concat(o.message):c+="string"==typeof o?": ".concat(o):": An unknown error occurred",console.error("Error fetching currently playing song:",o),new Error(c);case 5:return[2]}}))}))}),[]);return{getAllPlaylists:h,getPlaylistSongs:p,getCurrentlyPlayingSong:d}};export{o as useSpotify};
//# sourceMappingURL=index.mjs.map
